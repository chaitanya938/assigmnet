# Deployment Guide for Multi-Tenant Notes App

## Overview
This guide covers deploying the Multi-Tenant Notes Application on Render.com with both backend and frontend services.

## Project Structure
```
├── server/                 # Backend Node.js/Express API
├── client/                 # Frontend React application
├── render.yaml            # Render deployment configuration
└── build-frontend.sh      # Frontend build script (alternative)
```

## Backend Deployment (Already Working)
- **Service Type**: Web Service
- **Environment**: Node.js
- **Build Command**: `cd server && npm install`
- **Start Command**: `cd server && npm start`
- **Port**: 10000

## Frontend Deployment (Fixed Issues)

### Problem Identified
The original error was caused by:
1. React build process looking for files in wrong directory structure
2. ESLint warnings causing build issues
3. Missing homepage configuration in package.json

### Solutions Applied
1. **Fixed render.yaml configuration**:
   - Changed build command to: `cd client && npm install && npm run build`
   - Set staticPublishPath to: `client/build`

2. **Fixed React build issues**:
   - Added `"homepage": "."` to client/package.json
   - Fixed ESLint warnings in components
   - Used useCallback for proper dependency management

3. **Updated build script** (alternative approach):
   - Enhanced build-frontend.sh with better error handling
   - Added directory structure validation

## Deployment Steps

### 1. Backend Service
The backend is already deployed and working. Configuration in render.yaml:
```yaml
- type: web
  name: notes-app-backend
  env: node
  plan: free
  buildCommand: cd server && npm install
  startCommand: cd server && npm start
  envVars:
    - key: NODE_ENV
      value: production
    - key: MONGODB_URI
      value: mongodb+srv://gnanavardhini2_db_user:gnanavardhini@internshalassignment.ed9vdpa.mongodb.net/?retryWrites=true&w=majority&appName=Internshalassignment
    - key: JWT_SECRET
      generateValue: true
    - key: PORT
      value: 10000
```

### 2. Frontend Service
Updated configuration for frontend deployment:
```yaml
- type: web
  name: notes-app-frontend
  env: static
  buildCommand: cd client && npm install && npm run build
  staticPublishPath: client/build
  envVars:
    - key: REACT_APP_API_URL
      fromService:
        type: web
        name: notes-app-backend
        property: host
```

## Environment Variables

### Backend
- `NODE_ENV`: production
- `MONGODB_URI`: MongoDB connection string
- `JWT_SECRET`: Auto-generated by Render
- `PORT`: 10000

### Frontend
- `REACT_APP_API_URL`: Automatically set to backend service URL

## Testing Deployment

### Local Testing
1. Test backend: `cd server && npm start`
2. Test frontend: `cd client && npm start`
3. Test build: `cd client && npm run build`

### Production Testing
1. Check backend health: `https://your-backend-url.onrender.com/health`
2. Check frontend: `https://your-frontend-url.onrender.com`
3. Test API connectivity from frontend

## Troubleshooting

### Common Issues
1. **Build fails with "index.html not found"**
   - Solution: Ensure homepage field is set in package.json
   - Check that staticPublishPath matches build output directory

2. **CORS errors**
   - Solution: Backend has CORS configured for all origins
   - Check that REACT_APP_API_URL is correctly set

3. **API connection issues**
   - Solution: Verify backend service is running
   - Check environment variables are properly set

### Build Script Alternative
If the direct build command fails, you can use the build script:
```yaml
buildCommand: chmod +x build-frontend.sh && ./build-frontend.sh
```

## Features Working After Deployment
- ✅ User authentication (login/register)
- ✅ Multi-tenant support
- ✅ Notes CRUD operations
- ✅ User management
- ✅ Subscription management
- ✅ Responsive design
- ✅ CORS configuration
- ✅ Environment variable management

## Next Steps
1. Deploy using the updated render.yaml configuration
2. Test all functionality in production
3. Monitor logs for any issues
4. Set up custom domain if needed

## Support
If you encounter any issues:
1. Check Render service logs
2. Verify environment variables
3. Test API endpoints directly
4. Check browser console for frontend errors
